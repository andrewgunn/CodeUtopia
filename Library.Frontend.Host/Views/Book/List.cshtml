@{

    ViewBag.Title = "Books";
}

<h2>Books</h2>

<form id="register-book">
    <fieldset>
        <legend>Register a new book</legend>
        <input name="title" data-bind="value: title" />

        <button data-bind="click: registerBook">Register</button>
    </fieldset>
</form>

<hr />

<table id="books" class="table table-bordered table-hover table-striped">
    <thead>
        <tr>
            <th>Book ID</th>
            <th>Title</th>
            <th></th>
        </tr>
    </thead>
    <tbody style="display: none;" data-bind="foreach: books, visible: books().length">
        <tr>
            <td data-bind="text: bookId"></td>
            <td data-bind="text: title"></td>
            <td>
                <button class="btn btn-primary" data-bind="click: borrowBook, enable: canBorrow">Borrow</button>
                <button class="btn btn-primary" data-bind="click: returnBook, enable: canReturn">Return</button>
            </td>
        </tr>
    </tbody>
</table>

@section Scripts
{
    <script src="~/Scripts/jquery.signalR-2.1.2.min.js"></script>
    <script src="~/signalr/hubs"></script>
    <script src="~/CustomScripts/ViewModels/RegisterBookViewModel.js"></script>
    <script src="~/CustomScripts/ViewModels/BookViewModel.js"></script>
    <script src="~/CustomScripts/ViewModels/BooksViewModel.js"></script>


    <script>
        ;
        (function($) {
            $(function() {
                var bookHub = $.connection.bookHub;

                var registerBookViewModel = new RegisterBookViewModel(bookHub);
                var booksViewModel = new BooksViewModel(bookHub);

                $.connection.hub.start().done(function () {
                    ko.applyBindings(registerBookViewModel, $('#register-book')[0]);
                    ko.applyBindings(booksViewModel, $('#books')[0]);
                });

            });
        })(window.jQuery);
    </script>
}